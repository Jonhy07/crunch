{% extends "pool_base.html" %}
{% load static i18n %}
{% load crispy_forms_tags %}

{% block extra_css %}
<style>
	@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap');

	*{
		font-family: Poppins;
		color: #FFD4CD;
	}

	body
	{
		background-image: url("https://crunchdna.com/wp-content/uploads/2021/11/noise-35.png"), url("https://crunchdna.com/wp-content/uploads/2021/09/bg-nograin.jpg")!important;
		background-repeat: repeat, no-repeat!important;
		background-size: auto, cover!important;
		background-color:  #100C7B!important;
	}

	.card {
		background-color: transparent;
		background-image: linear-gradient(160deg,#FFFFFF45 0%,#FFFFFF00 160%);
		border-radius: 10px;
		box-shadow: 0 0 8px 0 rgb(0 0 0 / 25%);
	}

	.border-bottom {
		border-bottom: 1px solid #66579161!important;
	}

	.form-control {
		color: #ffd4cd!important;
		background-color: #3b306d!important;
		border-color: #60588a!important;
		outline: 0!important;
	}

	.form-control:focus {
		color: #ffd4cd;
		background-color: #3b306d;
		border-color: #60588a;
		outline: 0;
	}

	.btn {
		background: linear-gradient(286.07deg, #FF5A8C -27.13%, #FF7F58 80.7%);
		border-radius: 100px;
		color: #FFE3DE;
		border: none;
		text-transform: uppercase;
		font-weight: 700;
		letter-spacing: 1.5px;
	}

	h1 {
		font-family: Poppins;
		font-style: normal;
		font-weight: bold;
		font-size: 26.7245px;
		line-height: 32px;
		color: #FF6060;
	}

	h5 {
		font-family: Poppins;
		font-style: normal;
		font-weight: bold;
		font-size: 26.7245px;
		line-height: 32px;
		color: #FF6060;
	}

	.modal-content {
		background-image: url("https://crunchdna.com/wp-content/uploads/2021/11/noise-35.png"), url("https://crunchdna.com/wp-content/uploads/2021/09/bg-nograin.jpg");
		background-repeat: repeat, no-repeat;
		background-size: auto, cover;
		background-color:  #100C7B;
		border-radius: 8px;
	}

	.alert-danger {
		color: #f6cdc9!important;
		background-color: #716393;
		border-color: #8a80a5;
	}
	table {
		border-color:#ffffff30!important;
	}
	.table thead th{
		border-bottom: 1px solid #ffffff30!important;
	}
	.page-item.disabled .page-link {
		color: #FFD4CD!important;
		pointer-events: none;
		background-color: transparent!important;
		border-color: transparent!important;
	}
	.page-item.active .page-link {
		  background-color: #ff6960!important;
		border-color: #ff6960!important;
	}
	.pagination a {
		line-height: 1.08!important;
	}
	.text-muted {
		color: #FFD4CD!important;
		text-transform: uppercase;
		font-weight: 500;
	}
	.avatar-lg.rounded-circle.bg-success.border-success.border.shadow {
    	background: linear-gradient(94.23deg, #ffffff73 -15.75%, rgb(255 255 255 / 0%) 262.75%);
    	filter: drop-shadow(0px 6px 20px rgba(0, 0, 0, 0.25));
	}
	.form-select{
		background-color: rgba(255, 255, 255, 0.091);
		border: 1px solid rgba(255, 255, 255, 0.187);
		box-sizing: border-box;
		border-radius: 2px;
		color: #ffd4cd;
		background-image: url('/static/images/arrow-d.svg');
		background-repeat: no-repeat;
		background-position: right 0.9	rem center;
		background-size: 16px 14px;
	}

	.input-group-sm,.input-group	{
		background-color: rgba(255, 255, 255, 0.091)!important;
		border: 1px solid rgba(255, 255, 255, 0.187)!important;
		box-sizing: border-box!important;
		border-radius: 4px!important;
		color: #ffd4cd!important;
		background-repeat: no-repeat!important;
		background-position: right 0.9	rem center;
		background-size: 14px 10px;
	}
	option {
		color: #FF6060;
	}
</style>
{% endblock %}

{% block content %}
<!-- Start Content-->
<div class="container-fluid" style="padding-left: 2em;">

    <div class="row" style="padding-top: 3em;">
        <div class="col-7">
            <h1 class="page-title"><b>{{dashboard.name}}</b></h1>
            <p>{{dashboard.description}}</p>
        </div>
		{% if flag %}
	        <div class="col-2">
	            <select class="form-select" id="store_select" aria-label="Default select example">
					<option selected>Tiendas</option>
	                {% for s in stores %}
	                <option value="{{s}}">{{s}}</option>
	                {% endfor %}
	            </select>
			</div>
		{% endif %}
        <div class="col-2">
            <div class="input-group input-group">
                <input type="text" class="form-control border-0 shadow" id="dash-daterange">
                <span class="input-group-text bg-blue border-blue text-white">
                    <i class="mdi mdi-calendar-range"></i>
                </span>
            </div>
        </div>
        <div class="col-1" style="text-align: end;">
            <div>
                <ul class="list-unstyled topnav-menu float-end mb-0">
                    <li class="dropdown notification-list topbar-dropdown">
                        <a class="nav-link  waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false" style="color: #6c757d;">
                            <i class="fas fa-bars fa-2x"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end dropdown-lg">
                            <!-- item-->
                            <div class="dropdown-item noti-title">
                                <h5 class="m-0">
                                    <span class="float-end">
                                    </span>Dashboard Settings
                                </h5>
                            </div>
            
                            <div class="noti-scroll" data-simplebar>
                                <!-- item-->
                                <a href="#" class="dropdown-item notify-item  btn-abrir-popup" id="btn-abrir-popup-newrow">
                                    <div class="row">
                                        <div class="col-8"> 
                                            <p class="notify-details" style="margin-left: 0%;">Fila
                                                <small class="text-muted">AÃ±adir una nueva fila</small>
                                            </p>
                                        </div>
                                        <div class="col-4" style="text-align: end; padding-right: 3em;">
                                            <i class="bi bi-plus-lg fa-2x"></i>
                                        </div>
                                    </div>
                                </a>
                                 <!-- item-->
                                <a href="#" class="dropdown-item notify-item">
                                    <div class="row">
                                        <div class="col-8"> 
                                            <p class="notify-details" style="margin-left: 0%;">Controles
                                                <small class="text-muted">Ver controles del dashboard</small>
                                            </p>
                                        </div>
                                        <div class="col-4">
                                            <label class="switch"><input type="checkbox"><span class="slider round hide-off"></span></label>
                                        </div>

                                    </div>
                                </a>
                                <!-- item-->
                                <a class="dropdown-item notify-item" href="/dashboard{{dashboard.get_delete_url}}" title="Eliminar Dashboard" class="delete" onclick="return confirm('Esta accion borrara todas las graficas asociadas al dashboard')">
                                    <div class="row">
                                        <div class="col-8"> 
                                            <p class="notify-details" style="margin-left: 0%;">Dashboard
                                                <small class="text-muted">Eliminar el dashboard</small>
                                            </p>
                                        </div>
                                        <div class="col-4" style="text-align: end; padding-right: 3em;">
                                            <i class="bi bi-trash fa-2x"></i>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </li>
                </ul>
            </div> 
        </div>
    </div>
    <!-- end page title -->
    <!--Body-->
    <div class="row">
        <div class="col-12">
            <div id="content">
            </div>         
        </div>
    </div> 
    <!--End Body-->       
</div>
<br>

{% include 'partials/popups/newrow.html' %}
<!-- container -->
{% endblock %}
{% block extra_javascript %}
<!--script>
    $(function() {
            const urlParams = new URLSearchParams(window.location.search);
            var max = urlParams.get('max')
            var min = urlParams.get('min')
            $('#dash-daterange').val('2021-07-01');
            console.log(max);
            console.log(min);

        });
</script-->

<script>
    $(document).ready( function ()
    {
        $(function() {
            $("#dash-daterange").on('change', function() {
                var date = $(this).val();
                var max=0;
                var min=0;
                var searchParams = new URLSearchParams(window.location.search);
                if(date){
                    if (date.length<11){
                        //date=date.replace("-","").replace("-","");
                        //max=date;
                        //searchParams.set("max", max);
                        //window.location.search = searchParams.toString();
                    }else{
                        var date1=date.substring(0,10).replace("-","").replace("-","");
                        var date2=date.substring(14,24).replace("-","").replace("-","");
                        max=date1;
                        min=date2;
                        if(date2>date1){
                            max=date2;
                            min=date1;
                        }
                        searchParams.set("max", max);
                        searchParams.set("min", min);
                        window.location.search = searchParams.toString();   
                    }
                }
            }).change();
        });
        $(function() {
            $("#store_select").on('change', function() {
                var tiendaSelect = document.getElementById("store_select");
                var tienda = tiendaSelect.value;
                var max=0;
                var min=0;
                var store='';
                var searchParams = new URLSearchParams(window.location.search);
                if(tienda){
                    if (tienda.length > 8)
                    {
                        searchParams.set("max", max);
                        searchParams.set("min", min);
                        searchParams.set("tienda", tienda);
                        window.location.search = searchParams.toString();   
                    }
                }
            }).change();
        });

        /*document.querySelector('#example-date').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                var date = $(this).val();
                if(date){
                    date=date.replace("-","")
                    date=date.replace("-","")
                    var searchParams = new URLSearchParams(window.location.search);
                    searchParams.set("date", date);
                    window.location.search = searchParams.toString();
                }
            }
        });*/    
    });
</script>

<script>
    $(document).on('click', '.hide-on', function () {
        $('.hideme').hide();
        $(this).removeClass('hide-on');
        $(this).addClass('hide-off');
    })

    $(document).on('click', '.hide-off', function () {
    $('.hideme').show();
    $(this).removeClass('hide-off');
    $(this).addClass('hide-on');
    })
</script>


<!-- Enviar Template-->
<script>
    var template = ("{{template_dashboard|escapejs}}");
    document.getElementById("content").innerHTML=template
</script>


<!-- Enviar Charts-->
<script>
    var options = ("{{options|escapejs}}");
    var names = ("{{names|escapejs}}");
    const objOptions = JSON.parse(options);
    const objNames = JSON.parse(names);
    for (var i = 0; i < objNames.length; i++) {
        var chartDom = document.getElementById(objNames[i]);
        var myChart = echarts.init(chartDom);
        const obj = JSON.parse(objOptions[i]);
        myChart.setOption(obj);
    }
</script>

<!-- Enviar Tablas-->

{{script_tables | safe}}
{% endblock%}